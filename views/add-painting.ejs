<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FindYourArt</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>    
    <link rel="stylesheet" href="/css/purchase.css">
</head>

<body>
    <nav class="navbar navbar-expand-xl navbar-dark bg-dark py-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">FindYourArt</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                ariacontrols="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/cart">Кошик</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/profile">Профіль</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">Вийти</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-3">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb fs-5">
              <li class="breadcrumb-item "><a href="/" class="text-reset text-decoration-none">Галерея</a></li>
              <li class="breadcrumb-item "><a href="/profile" class="text-reset text-decoration-none">Профіль</a></li>
              <li class="breadcrumb-item active" aria-current="page">Додавання картини</li>
            </ol>
        </nav>
        <div class="row">
            <div class="col-12">
                <h2 class="mt-1">Додавання картини</h2>
                <% if (message) { %>
                    <div class="col-12">
                        <div class="alert alert-warning" role="alert">
                            <%= message %>
                        </div>
                    </div>
                    <% } %>
                            
                <div class="row mb-3 mt-5">
                    <div class="col-12">
                        <p class="h6 text-start">Назва картини</p>
                        <div class="input-group mb-3 w-100">
                            <input type="text" class="form-control" placeholder="Введіть назву" aria-describedby="basic-addon1" name="title" required>
                        </div>
                        <p id="title-feedback" class="text-danger"></p>
                    </div>
                </div>   
                <div class="row mb-3">
                    <div class="col-12 col-md-12">
                        <p class="h6 text-start">Опис картини</p>
                        <div class="input-group mb-3 w-100">
                            <textarea class="form-control" placeholder="Введіть опис" aria-describedby="basic-addon1" name="descript" rows="4" required></textarea>
                        </div>
                        <p id="descript-feedback" class="text-danger"></p>
                    </div>      
                </div> 
                <div class="row mb-3">
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Дата створення</p>
                        <div class="input-group mb-3 w-100">
                            <input type="date" class="form-control" placeholder="Виберіть дату" aria-describedby="basic-addon1" name="date-created">
                        </div>
                        <p id="date-feedback" class="text-danger"></p>
                    </div>
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Ціна картини</p>
                        <div class="input-group mb-3 w-100">
                            <input type="number" class="form-control" placeholder="Введіть ціну" aria-describedby="basic-addon1" name="price" required>
                        </div>
                        <p id="price-feedback" class="text-danger"></p>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Ширина</p>
                        <div class="input-group mb-3 w-100">
                            <input type="number" class="form-control" placeholder="Введіть ширину" aria-describedby="basic-addon1" name="width" required>
                        </div>
                        <p id="width-feedback" class="text-danger"></p>
                    </div>

                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Висота</p>
                        <div class="input-group mb-3 w-100">
                            <input type="number" class="form-control" placeholder="Введіть висоту" aria-describedby="basic-addon1" name="height" required>
                        </div>
                        <p id="height-feedback" class="text-danger"></p>
                    </div>   
                </div>
                <div class="row mb-3">
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Матеріал</p>
                        <div class="input-group mb-3 w-100">
                            <input type="text" class="form-control" placeholder="Введіть матеріал" aria-describedby="basic-addon1" name="material" required>
                        </div>
                        <p id="material-feedback" class="text-danger"></p>
                    </div>
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Посилання на картину</p>
                        <div class="input-group mb-3 w-100">
                            <input type="text" class="form-control" placeholder="Введіть посилання" aria-describedby="basic-addon1" name="link" required>
                        </div>
                        <p id="link-feedback" class="text-danger"></p>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Жанр</p>
                        <div class="input-group mb-3 w-100">
                            <select class="form-control" name="genre" required>
                                <option value="" disabled selected>Оберіть жанр</option>
                                <% genres.forEach(genre => { %>
                                    <option value="<%= genre.category_id %>"><%= genre.category_name %></option>
                                <% }) %>
                            </select>
                        </div>
                        <p id="genre-feedback" class="text-danger"></p>
                    </div>
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Стиль</p>
                        <div class="input-group mb-3 w-100">
                            <select class="form-control" name="style" required>
                                <option value="" disabled selected>Оберіть стиль</option>
                                <% styles.forEach(style => { %>
                                    <option value="<%=  style.category_id %>"><%= style.category_name %></option>
                                <% }) %>
                            </select>
                        </div>
                        <p id="style-feedback" class="text-danger"></p>
                    </div>
                </div>
                <h2 class="mt-1">Інформація про автора</h2>
                <div class="row mb-3 mt-4"> 
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Ім'я автора</p>
                        <div class="input-group mb-3 w-100">
                            <input type="text" class="form-control" placeholder="Введіть ім'я" aria-describedby="basic-addon1" name="name" required>
                        </div>
                        <p id="name-feedback" class="text-danger"></p>
                    </div>
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Фамілія автора</p>
                        <div class="input-group mb-3 w-100">
                            <input type="text" class="form-control" placeholder="Введіть фамілію" aria-describedby="basic-addon1" name="surname" required>
                        </div>
                        <p id="surname-feedback" class="text-danger"></p>
                    </div>
                </div>
                    <div class="row mb-3">
                        <div class="col-12 col-md-12">
                            <p class="h6 text-start">Про автора</p>
                            <div class="input-group mb-3 w-100">
                                <textarea class="form-control" placeholder="Введіть інформацію" aria-describedby="basic-addon1" name="bio" rows="4"></textarea>
                            </div>
                            <p id="bio-feedback" class="text-danger"></p>
                        </div>      
                    </div>
                <div class="row mb-3">
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Дата народження автора</p>
                        <div class="input-group mb-3 w-100">
                            <input type="date" class="form-control" placeholder="Виберіть дату" aria-describedby="basic-addon1" name="birth-date">
                        </div>
                        <p id="birth-date-feedback" class="text-danger"></p>
                    </div>
                    <div class="col-12 col-md-6">
                        <p class="h6 text-start">Країна автора</p>
                        <div class="input-group mb-3 w-100">
                            <input type="text" class="form-control" placeholder="Введіть країну" aria-describedby="basic-addon1" name="country">
                        </div>
                        <p id="country-feedback" class="text-danger"></p>
                    </div>
                </div>

                

                <form action="" method="">
                    <button type="submit" id="confirm-button" class="btn btn-success w-25 fs-6 mt-3 mb-5">Підтвердити</button>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        document.getElementById("confirm-button").addEventListener("click", function (event) {
            event.preventDefault();

            const title = document.querySelector('input[name="title"]').value;
            const descript = document.querySelector('textarea[name="descript"]').value;
            const dateCreated = document.querySelector('input[name="date-created"]').value;
            const price = document.querySelector('input[name="price"]').value;
            const width = document.querySelector('input[name="width"]').value;
            const height = document.querySelector('input[name="height"]').value;
            const material = document.querySelector('input[name="material"]').value;
            const link = document.querySelector('input[name="link"]').value;
            const genre = document.querySelector('select[name="genre"]').value;
            const style = document.querySelector('select[name="style"]').value;

            const name = document.querySelector('input[name="name"]').value;
            const surname = document.querySelector('input[name="surname"]').value;
            const bio = document.querySelector('textarea[name="bio"]').value;
            let birthDate = document.querySelector('input[name="birth-date"]').value;
            const country = document.querySelector('input[name="country"]').value;


            if (!birthDate) {
                birthDate = null;
            }

            clearFeedback();
            let formValid = true;

            if (!title) {
                showFeedback("Обов'язкове поле!", "title");
                formValid = false;
            }
            if (!descript) {
                showFeedback("Обов'язкове поле!", "descript");
                formValid = false;
            }
            if (!price) {
                showFeedback("Обов'язкове поле!", "price");
                formValid = false;
            }
            if (!width) {
                showFeedback("Обов'язкове поле!", "width");
                formValid = false;
            }
            if (!height) {
                showFeedback("Обов'язкове поле!", "height");
                formValid = false;
            }
            if (!material) {
                showFeedback("Обов'язкове поле!", "material");
                formValid = false;
            }
            if (!link) {
                showFeedback("Обов'язкове поле!", "link");
                formValid = false;
            } 
            if (!dateCreated) {
                showFeedback("Обов'язкове поле!", "date");
                formValid = false;
            }
            if (!name) {
                showFeedback("Обов'язкове поле!", "name");
                formValid = false;
            }
            if (!surname) {
                showFeedback("Обов'язкове поле!", "surname");
                formValid = false;
            }
            if (!genre) {
                showFeedback("Обов'язкове поле!", "genre");
                formValid = false;
            }
            if (!style) {
                showFeedback("Обов'язкове поле!", "style");
                formValid = false;
            }

            if (formValid) {
                makeRequest('/profile/add-painting', 'POST', title, descript, price, dateCreated, width, height, material, link, genre, style, name, surname, birthDate, bio, country);
            }
        });

        function makeRequest(path, method, ...data) {
                let requestBody = {
                    title: data[0],
                    descript: data[1],
                    price: data[2],
                    dateCreated: data[3],
                    width: data[4],
                    height: data[5],
                    material: data[6],
                    link: data[7],
                    genre: data[8],
                    style: data[9],
                    firstName: data[10],
                    lastName: data[11],
                    birthDate: data[12],
                    bio: data[13],
                    country: data[14]
                };

                fetch(path, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then((result) => {
                        window.location.href = result.redirect;
                    })
                    .catch((err) => {
                        console.error('Error:', err);
                    });
            }

        function showFeedback(message, field) {
            const feedbackElement = document.getElementById(`${field}-feedback`);
            feedbackElement.textContent = message;
        }

        function clearFeedback() {
            const feedbackElements = document.querySelectorAll('.text-danger');
            feedbackElements.forEach(feedback => feedback.textContent = '');
        }

    </script>
</body>
</html>